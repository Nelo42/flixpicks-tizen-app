<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FlixPicks Debug</title>
    <style>
        body { 
            font-family: monospace; 
            padding: 20px; 
            background: #1a1a2e; 
            color: #fff; 
        }
        pre { 
            background: #0f0f1a; 
            padding: 15px; 
            overflow: auto; 
            max-height: 300px; 
            margin: 10px 0;
        }
        .success { color: #51cf66; }
        .error { color: #ff6b6b; }
        .section { 
            margin: 20px 0; 
            padding: 15px; 
            border: 1px solid #333; 
        }
        h2 { color: #3B82F6; }
        .card-preview {
            display: inline-block;
            width: 150px;
            margin: 10px;
            text-align: center;
        }
        .card-preview img {
            width: 100%;
            border-radius: 8px;
        }
    </style>
</head>
<body>
    <h1>FlixPicks TV App Debug</h1>
    
    <div class="section">
        <h2>1. API Test</h2>
        <button onclick="testAPI()">Test Trending API</button>
        <pre id="apiResult">Click to test...</pre>
    </div>
    
    <div class="section">
        <h2>2. Card Rendering Test</h2>
        <button onclick="testCards()">Render Test Cards</button>
        <div id="cardContainer"></div>
    </div>
    
    <div class="section">
        <h2>3. Console Logs</h2>
        <pre id="logs"></pre>
    </div>
    
    <script>
        // Capture console logs
        const logEl = document.getElementById('logs');
        const originalLog = console.log;
        console.log = function(...args) {
            originalLog.apply(console, args);
            logEl.textContent += args.map(a => 
                typeof a === 'object' ? JSON.stringify(a, null, 2) : String(a)
            ).join(' ') + '\n';
        };
        
        const API_BASE = window.location.hostname === 'flixpicks.net' 
            ? '/api/v1' 
            : 'https://flixpicks.net/api/v1';
        
        console.log('API Base:', API_BASE);
        
        async function testAPI() {
            const resultEl = document.getElementById('apiResult');
            resultEl.textContent = 'Loading...';
            
            try {
                const url = API_BASE + '/trending?media_type=movie&window=week&filter_available=false';
                console.log('Fetching:', url);
                
                const response = await fetch(url);
                const data = await response.json();
                
                console.log('Got', data.results?.length, 'results');
                
                resultEl.textContent = JSON.stringify(data, null, 2);
                resultEl.className = 'success';
                
                // Store for card test
                window.testData = data;
                
            } catch (error) {
                resultEl.textContent = 'Error: ' + error.message;
                resultEl.className = 'error';
                console.log('Error:', error);
            }
        }
        
        function testCards() {
            const container = document.getElementById('cardContainer');
            
            if (!window.testData || !window.testData.results) {
                container.innerHTML = '<p class="error">Run API test first!</p>';
                return;
            }
            
            container.innerHTML = '';
            
            window.testData.results.slice(0, 5).forEach(item => {
                console.log('Rendering card for:', item.title);
                console.log('  poster_url:', item.poster_url);
                console.log('  poster_path:', item.poster_path);
                
                const posterUrl = item.poster_url || 
                    (item.poster_path ? `https://image.tmdb.org/t/p/w342${item.poster_path}` : null);
                
                const card = document.createElement('div');
                card.className = 'card-preview';
                card.innerHTML = `
                    <img src="${posterUrl || 'assets/images/poster-placeholder.svg'}" 
                         alt="${item.title}"
                         onerror="this.src='assets/images/poster-placeholder.svg'">
                    <p>${item.title}</p>
                    <small>‚≠ê ${item.vote_average?.toFixed(1) || 'N/A'}</small>
                `;
                container.appendChild(card);
            });
            
            console.log('Rendered', window.testData.results.slice(0, 5).length, 'cards');
        }
        
        // Auto-run API test
        testAPI();
    </script>
</body>
</html>

